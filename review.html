<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Review Needed Feedback</title>
    <style>
    .container { max-width: 700px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px #ccc; }
    .review-item { margin-bottom: 18px; padding: 12px; background: #f9f9f9; border-radius: 6px; }
    .rate-btn { font-size: 1.5em; margin: 0 8px; cursor: pointer; background: none; border: none; }
    #save-btn { margin-top: 24px; padding: 8px 18px; font-size: 1em; border-radius: 6px; background: #0078d4; color: #fff; border: none; cursor: pointer; }
    #save-status { margin-top: 12px; color: green; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Review Needed Feedback</h1>
        <input type="file" id="file-input" accept=".jsonl">
        <div id="review-list"></div>
        <button id="save-btn">Save Ratings</button>
        <div id="save-status"></div>
    </div>
    <script>
    let reviewData = [];
    let ratings = {};
    document.getElementById('file-input').onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
            const text = evt.target.result;
            reviewData = text.trim().split('\n').map(line => JSON.parse(line));
            const listDiv = document.getElementById('review-list');
            listDiv.innerHTML = '';
            reviewData.forEach((entry, idx) => {
                listDiv.appendChild(createReviewItem(entry, idx));
            });
            document.querySelectorAll('.rate-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = btn.getAttribute('data-idx');
                    const rating = parseInt(btn.getAttribute('data-rating'));
                    ratings[idx] = rating;
                    document.getElementById(`rate-status-${idx}`).textContent = rating ? 'üëç' : 'üëé';
                };
            });
        };
        reader.readAsText(file);
    };
    function createReviewItem(entry, idx) {
        const div = document.createElement('div');
        div.className = 'review-item';
        div.innerHTML = `
            <b>Prompt:</b> ${entry.prompt}<br>
            <b>Reply:</b> ${entry.reply}<br>
            <b>Score:</b> ${entry.score ? entry.score.toFixed(2) : ''}<br>
            <label>Rate:</label>
            <button class="rate-btn" data-idx="${idx}" data-rating="1">üëç</button>
            <button class="rate-btn" data-idx="${idx}" data-rating="0">üëé</button>
            <span id="rate-status-${idx}"></span>
            <hr>
        `;
        return div;
    }
    document.getElementById('save-btn').onclick = function() {
        let lines = [];
        for (const idx in ratings) {
            const entry = reviewData[idx];
            lines.push(JSON.stringify({
                prompt: entry.prompt,
                reply: entry.reply,
                rating: ratings[idx],
                model: 'book_chatbot_model.json'
            }));
        }
        const blob = new Blob([lines.join('\n')], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'reviewed_feedback.jsonl';
        a.click();
        document.getElementById('save-status').textContent = 'Ratings saved! Downloaded as reviewed_feedback.jsonl.';
    };
    </script>
</body>
</html>
